<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stats vs Scouts Decision Lab</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --bg: #0a0e1a;
    --card: #141929;
    --card-hover: #1a2035;
    --accent: #4f7cff;
    --accent2: #ff6b4f;
    --green: #34d399;
    --gold: #fbbf24;
    --text: #e2e8f0;
    --muted: #8892a8;
    --border: #232942;
    --scout-bg: #1e1535;
    --stat-bg: #0f1f2e;
    --correct: #065f46;
    --wrong: #7f1d1d;
  }

  body {
    font-family: 'Inter', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ── Animated background ── */
  .bg-anim {
    position: fixed; inset: 0; z-index: 0; pointer-events: none;
    background:
      radial-gradient(ellipse 80% 50% at 50% -20%, rgba(79,124,255,.15), transparent),
      radial-gradient(ellipse 60% 40% at 80% 100%, rgba(255,107,79,.08), transparent);
  }

  /* ── Layout ── */
  .container { max-width: 1100px; margin: 0 auto; padding: 1.5rem; position: relative; z-index: 1; }

  /* ── Header ── */
  header {
    text-align: center; padding: 2rem 0 1rem;
  }
  header h1 {
    font-size: 2.4rem; font-weight: 900;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    letter-spacing: -1px;
  }
  header p { color: var(--muted); margin-top: .4rem; font-size: 1rem; }

  /* ── Progress bar ── */
  .progress-wrap {
    display: flex; align-items: center; gap: .75rem;
    background: var(--card); border: 1px solid var(--border);
    border-radius: 999px; padding: .5rem 1.2rem; margin: 1.5rem auto; max-width: 600px;
  }
  .progress-wrap span { font-size: .8rem; color: var(--muted); white-space: nowrap; font-weight: 600; }
  .progress-bar { flex: 1; height: 8px; background: var(--border); border-radius: 999px; overflow: hidden; }
  .progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), var(--green)); border-radius: 999px; transition: width .6s ease; }

  /* ── Screens ── */
  .screen { display: none; animation: fadeUp .5s ease; }
  .screen.active { display: block; }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

  /* ── Intro ── */
  .intro-box {
    text-align: center; padding: 3rem 2rem;
    background: var(--card); border: 1px solid var(--border); border-radius: 1.2rem;
    max-width: 700px; margin: 2rem auto;
  }
  .intro-box h2 { font-size: 1.6rem; margin-bottom: 1rem; }
  .intro-box p { color: var(--muted); line-height: 1.7; margin-bottom: 1.5rem; }
  .intro-box .emoji { font-size: 3rem; margin-bottom: 1rem; }

  /* ── Buttons ── */
  .btn {
    display: inline-flex; align-items: center; gap: .5rem;
    padding: .85rem 2rem; border: none; border-radius: .6rem;
    font-family: inherit; font-weight: 700; font-size: 1rem;
    cursor: pointer; transition: all .2s;
  }
  .btn-primary { background: var(--accent); color: #fff; }
  .btn-primary:hover { background: #3d6ae8; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(79,124,255,.3); }
  .btn-secondary { background: var(--border); color: var(--text); }
  .btn-secondary:hover { background: #2d3555; }
  .btn-gold { background: linear-gradient(135deg, var(--gold), #f59e0b); color: #000; }
  .btn-gold:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(251,191,36,.3); }
  .btn:disabled { opacity: .4; cursor: not-allowed; transform: none !important; box-shadow: none !important; }

  /* ── Stage header ── */
  .stage-header {
    text-align: center; margin-bottom: 2rem;
  }
  .stage-label {
    display: inline-block; background: var(--accent); color: #fff; font-size: .7rem;
    font-weight: 700; padding: .3rem .8rem; border-radius: 999px; text-transform: uppercase;
    letter-spacing: 1px; margin-bottom: .5rem;
  }
  .stage-header h2 { font-size: 1.5rem; font-weight: 800; }
  .stage-header p { color: var(--muted); margin-top: .3rem; }

  /* ── Player card ── */
  .player-card {
    background: var(--card); border: 1px solid var(--border); border-radius: 1rem;
    margin-bottom: 1.5rem; overflow: hidden; transition: border-color .3s;
  }
  .player-card:hover { border-color: #3a4566; }
  .player-card-head {
    display: flex; align-items: center; gap: 1rem;
    padding: 1.2rem 1.5rem; border-bottom: 1px solid var(--border);
    background: rgba(255,255,255,.02);
  }
  .player-avatar {
    width: 56px; height: 56px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.5rem; font-weight: 800; color: #fff; flex-shrink: 0;
  }
  .player-info h3 { font-size: 1.1rem; font-weight: 700; }
  .player-info .team-pos { font-size: .8rem; color: var(--muted); }

  .card-columns {
    display: grid; grid-template-columns: 1fr 1fr; gap: 0;
  }
  .card-col {
    padding: 1.2rem 1.5rem;
  }
  .card-col:first-child { border-right: 1px solid var(--border); }
  .card-col-label {
    font-size: .65rem; font-weight: 700; text-transform: uppercase;
    letter-spacing: 1.5px; margin-bottom: .8rem; display: flex; align-items: center; gap: .4rem;
  }
  .label-scout { color: #c084fc; }
  .label-stat { color: #38bdf8; }
  .card-col p { font-size: .88rem; color: var(--muted); line-height: 1.6; }

  .stat-grid {
    display: grid; grid-template-columns: 1fr 1fr; gap: .5rem;
  }
  .stat-item {
    background: rgba(255,255,255,.03); border-radius: .5rem; padding: .5rem .7rem;
  }
  .stat-item .stat-val { font-size: 1.05rem; font-weight: 800; color: var(--text); }
  .stat-item .stat-label { font-size: .65rem; color: var(--muted); text-transform: uppercase; letter-spacing: .5px; }

  /* ── Choice buttons in Stage 1 ── */
  .choice-row {
    display: flex; gap: .75rem; padding: 1rem 1.5rem; border-top: 1px solid var(--border);
    flex-wrap: wrap;
  }
  .choice-btn {
    flex: 1; min-width: 100px; padding: .65rem .5rem; border: 2px solid var(--border);
    background: transparent; border-radius: .5rem; color: var(--text);
    font-family: inherit; font-weight: 600; font-size: .82rem; cursor: pointer; transition: all .2s;
  }
  .choice-btn:hover { border-color: var(--accent); background: rgba(79,124,255,.08); }
  .choice-btn.selected { border-color: var(--accent); background: rgba(79,124,255,.15); color: #fff; }
  .choice-btn.correct { border-color: var(--green); background: rgba(52,211,153,.12); color: var(--green); }
  .choice-btn.wrong { border-color: var(--accent2); background: rgba(255,107,79,.12); color: var(--accent2); }
  .choice-btn:disabled { cursor: default; opacity: .7; }

  /* ── Reveal overlay ── */
  .reveal-bar {
    display: none; padding: 1rem 1.5rem; border-top: 1px solid var(--border);
    background: rgba(255,255,255,.02); animation: fadeUp .4s ease;
  }
  .reveal-bar.show { display: flex; align-items: flex-start; gap: 1rem; }
  .reveal-icon { font-size: 1.5rem; flex-shrink: 0; margin-top: 2px; }
  .reveal-text h4 { font-size: .95rem; font-weight: 700; margin-bottom: .25rem; }
  .reveal-text p { font-size: .82rem; color: var(--muted); line-height: 1.5; }

  /* ── Stage 2 sign cards ── */
  .sign-cards {
    display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;
  }
  @media (max-width: 700px) { .sign-cards { grid-template-columns: 1fr; } .card-columns { grid-template-columns: 1fr; } .card-col:first-child { border-right: none; border-bottom: 1px solid var(--border); } }

  .sign-card {
    background: var(--card); border: 2px solid var(--border); border-radius: 1rem;
    overflow: hidden; cursor: pointer; transition: all .3s;
    position: relative;
  }
  .sign-card:hover { border-color: #3a4566; transform: translateY(-3px); box-shadow: 0 8px 30px rgba(0,0,0,.3); }
  .sign-card.selected-sign { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(79,124,255,.2); }
  .sign-card.correct-sign { border-color: var(--green); box-shadow: 0 0 0 3px rgba(52,211,153,.2); }
  .sign-card.wrong-sign { border-color: var(--accent2); box-shadow: 0 0 0 3px rgba(255,107,79,.2); }
  .sign-card-head {
    padding: 1.5rem; text-align: center; border-bottom: 1px solid var(--border);
  }
  .sign-card-head .player-avatar { margin: 0 auto .8rem; width: 70px; height: 70px; font-size: 1.8rem; }
  .sign-card-head h3 { font-size: 1.15rem; font-weight: 800; }
  .sign-card-head .team-pos { color: var(--muted); font-size: .82rem; }
  .sign-card-body { padding: 1.2rem 1.5rem; }
  .sign-card-body h4 { font-size: .7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; color: var(--muted); margin-bottom: .6rem; }
  .sign-card-body p { font-size: .85rem; color: var(--muted); line-height: 1.6; margin-bottom: 1rem; }

  .contract-tag {
    display: inline-block; padding: .4rem .8rem; border-radius: .4rem;
    font-weight: 700; font-size: .85rem; margin-bottom: .5rem;
  }
  .contract-blue { background: rgba(79,124,255,.15); color: var(--accent); }
  .contract-green { background: rgba(52,211,153,.15); color: var(--green); }

  .mini-stat { display: flex; justify-content: space-between; padding: .35rem 0; border-bottom: 1px solid var(--border); font-size: .82rem; }
  .mini-stat:last-child { border-bottom: none; }
  .mini-stat .ms-label { color: var(--muted); }
  .mini-stat .ms-val { font-weight: 700; }

  .sign-badge {
    position: absolute; top: 1rem; right: 1rem; padding: .3rem .7rem;
    border-radius: 999px; font-size: .7rem; font-weight: 700;
    text-transform: uppercase; letter-spacing: .5px; display: none;
  }
  .sign-card.correct-sign .sign-badge { display: block; background: var(--green); color: #000; }
  .sign-card.wrong-sign .sign-badge { display: block; background: var(--accent2); color: #fff; }

  /* ── Results ── */
  .results-box {
    text-align: center; padding: 3rem 2rem;
    background: var(--card); border: 1px solid var(--border); border-radius: 1.2rem;
    max-width: 700px; margin: 2rem auto;
  }
  .results-box h2 { font-size: 1.8rem; margin-bottom: .5rem; }
  .score-big {
    font-size: 4rem; font-weight: 900;
    background: linear-gradient(135deg, var(--accent), var(--green));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    margin: 1rem 0;
  }
  .score-breakdown {
    display: flex; justify-content: center; gap: 2rem; margin: 1.5rem 0;
  }
  .score-part { text-align: center; }
  .score-part .sp-num { font-size: 1.5rem; font-weight: 800; }
  .score-part .sp-label { font-size: .75rem; color: var(--muted); text-transform: uppercase; letter-spacing: .5px; }
  .verdict {
    background: rgba(255,255,255,.04); border-radius: .8rem; padding: 1.2rem;
    margin-top: 1.5rem; max-width: 500px; margin-left: auto; margin-right: auto;
  }
  .verdict h4 { margin-bottom: .4rem; font-size: 1rem; }
  .verdict p { color: var(--muted); font-size: .88rem; line-height: 1.6; }

  /* ── Action footer ── */
  .action-footer {
    text-align: center; margin: 2rem 0;
  }

  /* ── Tooltip on stage explanation ── */
  .stage-explain {
    background: rgba(79,124,255,.08); border: 1px solid rgba(79,124,255,.2);
    border-radius: .8rem; padding: 1rem 1.5rem; margin-bottom: 2rem;
    font-size: .88rem; color: var(--muted); line-height: 1.6; text-align: center;
  }
  .stage-explain strong { color: var(--text); }

  /* Timer bar */
  .timer-bar-wrap {
    max-width: 600px; margin: 0 auto 1.5rem; display: flex; align-items: center; gap: .75rem;
  }
  .timer-bar-wrap .timer-label { font-size: .8rem; color: var(--muted); font-weight: 600; white-space: nowrap; }
  .timer-track { flex: 1; height: 6px; background: var(--border); border-radius: 999px; overflow: hidden; }
  .timer-fill { height: 100%; background: var(--gold); border-radius: 999px; transition: width .25s linear; width: 100%; }
  .timer-fill.danger { background: var(--accent2); }
</style>
</head>
<body>
<div class="bg-anim"></div>
<div class="container">

  <!-- Header -->
  <header>
    <h1>Stats vs Scouts Decision Lab</h1>
    <p>Can you tell who the scouts loved vs. what the numbers say?</p>
  </header>

  <!-- Progress -->
  <div class="progress-wrap">
    <span id="progLabel">0 / 4</span>
    <div class="progress-bar"><div class="progress-fill" id="progFill"></div></div>
    <span id="scoreLabel">Score: 0</span>
  </div>

  <!-- ════════════ SCREEN: INTRO ════════════ -->
  <div class="screen active" id="introScreen">
    <div class="intro-box">
      <div class="emoji">&#127936;</div>
      <h2>Welcome, GM</h2>
      <p>You've just been hired as the new General Manager. Your front office has <strong>scout reports</strong> and <strong>advanced analytics</strong> on real NBA players &mdash; but they don't always agree.<br><br>
      Your job: figure out <strong>who was more right</strong>, then make a <strong>real signing decision</strong> using both lenses.</p>
      <button class="btn btn-primary" onclick="startGame()">Start the Lab</button>
    </div>
  </div>

  <!-- ════════════ SCREEN: STAGE 1 ════════════ -->
  <div class="screen" id="stage1Screen">
    <div class="stage-header">
      <span class="stage-label">Stage 1</span>
      <h2>Who Was More Right?</h2>
      <p>For each real player, read the scout take and the stats &mdash; then decide which side told the real story.</p>
    </div>

    <div class="stage-explain">
      <strong>How it works:</strong> Each card shows a real NBA player. The left side is the <strong>scouting report</strong> and the right side is the <strong>advanced stats</strong>. Pick who was more right: the scouts, the stats, or both.
    </div>

    <div id="stage1Cards"></div>

    <div class="action-footer">
      <button class="btn btn-primary" id="stage1Next" disabled onclick="goToStage2()">Continue to Stage 2</button>
    </div>
  </div>

  <!-- ════════════ SCREEN: STAGE 2 ════════════ -->
  <div class="screen" id="stage2Screen">
    <div class="stage-header">
      <span class="stage-label" style="background:var(--accent2)">Stage 2</span>
      <h2>Who Should You Sign?</h2>
      <p>Use everything you've learned. Pick the smarter signing for your franchise.</p>
    </div>

    <div class="stage-explain">
      <strong>The scenario:</strong> Your team needs a difference-maker. You have cap space and two real free agents to choose from. Consider the <strong>scouting report</strong>, <strong>advanced stats</strong>, and the <strong>contract</strong>. Who gives you more value?
    </div>

    <div class="timer-bar-wrap" id="timerWrap" style="display:none;">
      <span class="timer-label" id="timerText">30s</span>
      <div class="timer-track"><div class="timer-fill" id="timerFill"></div></div>
    </div>

    <div class="sign-cards" id="stage2Cards"></div>

    <div class="action-footer">
      <button class="btn btn-gold" id="stage2Confirm" disabled onclick="confirmSign()">Confirm Signing</button>
    </div>
  </div>

  <!-- ════════════ SCREEN: RESULTS ════════════ -->
  <div class="screen" id="resultsScreen">
    <div class="results-box">
      <div class="emoji">&#127942;</div>
      <h2>Lab Complete</h2>
      <div class="score-big" id="finalScore">0 / 4</div>
      <div class="score-breakdown">
        <div class="score-part">
          <div class="sp-num" id="s1Score">0/3</div>
          <div class="sp-label">Stage 1</div>
        </div>
        <div class="score-part">
          <div class="sp-num" id="s2Score">0/1</div>
          <div class="sp-label">Stage 2</div>
        </div>
      </div>
      <div class="verdict" id="verdictBox">
        <h4 id="verdictTitle"></h4>
        <p id="verdictText"></p>
      </div>
      <br>
      <button class="btn btn-primary" onclick="location.reload()">Play Again</button>
    </div>
  </div>

</div>

<script>
// ═══════════════════════════════════════════
//  REAL NBA PLAYER DATA
// ═══════════════════════════════════════════

const stage1Players = [
  {
    name: "Andrew Wiggins",
    team: "MIN (2015-20)",
    pos: "SF",
    color: "#1d428a",
    initials: "AW",
    scout: "Explosive scorer with elite athleticism. Smooth jumper, can create his own shot. High ceiling &mdash; potential franchise cornerstone. Draws comparisons to a young T-Mac.",
    stats: [
      { label: "PPG", val: "22.4" },
      { label: "TS%", val: "50.3%" },
      { label: "TO/G", val: "2.3" },
      { label: "DEF RTG", val: "112" },
      { label: "On/Off", val: "-4.2" },
      { label: "WS/48", val: ".048" }
    ],
    answer: "stats",
    revealTitle: "The stats were more right.",
    revealText: "Scouts loved Wiggins' tools, but advanced stats always showed inefficiency (50% TS), poor defense, and a negative on/off. He didn't become a true impact player until Golden State reshaped his role."
  },
  {
    name: "Draymond Green",
    team: "GSW (2015-20)",
    pos: "PF",
    color: "#006bb6",
    initials: "DG",
    scout: "Undersized, limited scorer, tweener body. High basketball IQ and motor but lacks a go-to offensive skill. Second-round talent at best.",
    stats: [
      { label: "PPG", val: "11.3" },
      { label: "TS%", val: "56.4%" },
      { label: "AST/G", val: "7.0" },
      { label: "DEF RTG", val: "101" },
      { label: "On/Off", val: "+7.8" },
      { label: "WS/48", val: ".152" }
    ],
    answer: "stats",
    revealTitle: "The stats were more right.",
    revealText: "Scouts saw a limited tweener. The stats saw elite defense (101 DEF RTG), elite playmaking (7 APG), and a massive +7.8 on/off swing. Draymond became a DPOY and the engine of a dynasty."
  },
  {
    name: "Luka Doncic",
    team: "DAL (2019-23)",
    pos: "PG/SG",
    color: "#00538c",
    initials: "LD",
    scout: "Generational feel for the game. Elite passer, scorer, and leader. Could be the best European prospect ever. Concerns: lateral quickness, NBA athleticism, and defensive effort.",
    stats: [
      { label: "PPG", val: "28.7" },
      { label: "TS%", val: "57.8%" },
      { label: "AST/G", val: "8.7" },
      { label: "DEF RTG", val: "113" },
      { label: "On/Off", val: "+3.1" },
      { label: "WS/48", val: ".149" }
    ],
    answer: "both",
    revealTitle: "Both were right!",
    revealText: "Scouts nailed his offensive genius AND flagged real defensive concerns (113 DEF RTG). Stats confirmed he's an elite offensive engine (28.7 PPG, 57.8% TS) with middling defense. Both lenses painted an accurate picture."
  }
];

const stage2Players = [
  {
    name: "Zach LaVine",
    team: "CHI Bulls",
    pos: "SG",
    color: "#ce1141",
    initials: "ZL",
    contract: "4 yr / $84M",
    contractClass: "contract-blue",
    scout: "Electric scorer and explosive athlete. Highlight-reel dunker. Can get a bucket anytime &mdash; a go-to option in crunch time. Injury history is a concern.",
    statLines: [
      { label: "PPG", val: "24.8" },
      { label: "TS%", val: "57.6%" },
      { label: "DEF RTG", val: "114" },
      { label: "On/Off", val: "-1.3" },
      { label: "WS/48", val: ".089" },
      { label: "VORP", val: "1.8" }
    ]
  },
  {
    name: "Mikal Bridges",
    team: "PHX / BKN",
    pos: "SF",
    color: "#1d1160",
    initials: "MB",
    contract: "4 yr / $52M",
    contractClass: "contract-green",
    scout: "Elite 3-and-D wing. High IQ, never out of position. Won't wow you with highlights but raises every lineup's floor. Ironman durability.",
    statLines: [
      { label: "PPG", val: "14.8" },
      { label: "TS%", val: "60.2%" },
      { label: "DEF RTG", val: "107" },
      { label: "On/Off", val: "+4.2" },
      { label: "WS/48", val: ".122" },
      { label: "VORP", val: "2.1" }
    ]
  }
];

const stage2Answer = 1; // Mikal Bridges index — better value

// ═══════════════════════════════════════════
//  GAME STATE
// ═══════════════════════════════════════════
let s1Answers = [null, null, null];
let s1Locked  = [false, false, false];
let s2Choice  = null;
let s2Locked  = false;
let score = 0;
let totalQ = 4;
let answered = 0;
let timerInterval = null;

// ═══════════════════════════════════════════
//  RENDER FUNCTIONS
// ═══════════════════════════════════════════

function renderStage1() {
  const wrap = document.getElementById('stage1Cards');
  wrap.innerHTML = '';
  stage1Players.forEach((p, i) => {
    const card = document.createElement('div');
    card.className = 'player-card';
    card.id = `s1card${i}`;
    card.innerHTML = `
      <div class="player-card-head">
        <div class="player-avatar" style="background:${p.color}">${p.initials}</div>
        <div class="player-info">
          <h3>${p.name}</h3>
          <span class="team-pos">${p.team} &bull; ${p.pos}</span>
        </div>
      </div>
      <div class="card-columns">
        <div class="card-col">
          <div class="card-col-label label-scout">&#128065; Scout Report</div>
          <p>${p.scout}</p>
        </div>
        <div class="card-col">
          <div class="card-col-label label-stat">&#128202; Advanced Stats</div>
          <div class="stat-grid">
            ${p.stats.map(s => `<div class="stat-item"><div class="stat-val">${s.val}</div><div class="stat-label">${s.label}</div></div>`).join('')}
          </div>
        </div>
      </div>
      <div class="choice-row" id="choices${i}">
        <button class="choice-btn" data-idx="${i}" data-val="scouts" onclick="pickS1(${i},'scouts',this)">Scouts</button>
        <button class="choice-btn" data-idx="${i}" data-val="stats" onclick="pickS1(${i},'stats',this)">Stats</button>
        <button class="choice-btn" data-idx="${i}" data-val="both" onclick="pickS1(${i},'both',this)">Both</button>
      </div>
      <div class="reveal-bar" id="reveal${i}">
        <div class="reveal-icon" id="revealIcon${i}"></div>
        <div class="reveal-text">
          <h4 id="revealTitle${i}"></h4>
          <p id="revealText${i}"></p>
        </div>
      </div>
    `;
    wrap.appendChild(card);
  });
}

function renderStage2() {
  const wrap = document.getElementById('stage2Cards');
  wrap.innerHTML = '';
  stage2Players.forEach((p, i) => {
    const card = document.createElement('div');
    card.className = 'sign-card';
    card.id = `s2card${i}`;
    card.onclick = () => pickS2(i);
    card.innerHTML = `
      <span class="sign-badge" id="s2badge${i}"></span>
      <div class="sign-card-head">
        <div class="player-avatar" style="background:${p.color}">${p.initials}</div>
        <h3>${p.name}</h3>
        <div class="team-pos">${p.team} &bull; ${p.pos}</div>
        <div class="contract-tag ${p.contractClass}" style="margin-top:.8rem">${p.contract}</div>
      </div>
      <div class="sign-card-body">
        <h4>&#128065; Scout Take</h4>
        <p>${p.scout}</p>
        <h4>&#128202; Key Stats</h4>
        ${p.statLines.map(s => `<div class="mini-stat"><span class="ms-label">${s.label}</span><span class="ms-val">${s.val}</span></div>`).join('')}
      </div>
    `;
    wrap.appendChild(card);
  });
}

// ═══════════════════════════════════════════
//  GAME LOGIC
// ═══════════════════════════════════════════

function startGame() {
  show('stage1Screen');
  renderStage1();
  updateProgress();
}

function pickS1(idx, val, btn) {
  if (s1Locked[idx]) return;
  // Toggle selection
  const row = document.getElementById(`choices${idx}`);
  row.querySelectorAll('.choice-btn').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  s1Answers[idx] = val;

  // Lock immediately and reveal
  s1Locked[idx] = true;
  const correct = stage1Players[idx].answer;
  const isCorrect = val === correct;

  row.querySelectorAll('.choice-btn').forEach(b => {
    b.disabled = true;
    if (b.dataset.val === correct) b.classList.add('correct');
    if (b.dataset.val === val && !isCorrect) b.classList.add('wrong');
  });

  if (isCorrect) score++;
  answered++;

  // Reveal explanation
  const rev = document.getElementById(`reveal${idx}`);
  rev.classList.add('show');
  document.getElementById(`revealIcon${idx}`).textContent = isCorrect ? '\u2705' : '\u274C';
  document.getElementById(`revealTitle${idx}`).textContent = stage1Players[idx].revealTitle;
  document.getElementById(`revealText${idx}`).textContent = stage1Players[idx].revealText;

  updateProgress();

  // Enable continue if all 3 answered
  if (s1Locked.every(Boolean)) {
    document.getElementById('stage1Next').disabled = false;
  }
}

function goToStage2() {
  show('stage2Screen');
  renderStage2();
  startTimer(30);
}

function pickS2(idx) {
  if (s2Locked) return;
  s2Choice = idx;
  document.querySelectorAll('.sign-card').forEach((c, i) => {
    c.classList.toggle('selected-sign', i === idx);
  });
  document.getElementById('stage2Confirm').disabled = false;
}

function confirmSign() {
  if (s2Locked || s2Choice === null) return;
  s2Locked = true;
  clearInterval(timerInterval);

  const isCorrect = s2Choice === stage2Answer;
  if (isCorrect) score++;
  answered++;

  document.querySelectorAll('.sign-card').forEach((c, i) => {
    c.classList.remove('selected-sign');
    c.onclick = null;
    c.style.cursor = 'default';
    if (i === stage2Answer) {
      c.classList.add('correct-sign');
      document.getElementById(`s2badge${i}`).textContent = 'Best Value';
    }
    if (i === s2Choice && !isCorrect) {
      c.classList.add('wrong-sign');
      document.getElementById(`s2badge${i}`).textContent = 'Your Pick';
    }
  });
  document.getElementById('stage2Confirm').disabled = true;

  updateProgress();
  setTimeout(showResults, 1800);
}

function startTimer(seconds) {
  const wrap = document.getElementById('timerWrap');
  const fill = document.getElementById('timerFill');
  const text = document.getElementById('timerText');
  wrap.style.display = 'flex';
  let remaining = seconds;
  fill.style.width = '100%';
  fill.classList.remove('danger');
  text.textContent = remaining + 's';

  timerInterval = setInterval(() => {
    remaining--;
    if (remaining <= 0) {
      clearInterval(timerInterval);
      remaining = 0;
      // Auto-submit if player hasn't chosen
      if (!s2Locked) {
        if (s2Choice === null) {
          s2Choice = 1 - stage2Answer; // wrong default
          document.querySelectorAll('.sign-card')[s2Choice].classList.add('selected-sign');
        }
        confirmSign();
      }
    }
    const pct = (remaining / seconds) * 100;
    fill.style.width = pct + '%';
    if (pct < 30) fill.classList.add('danger');
    text.textContent = remaining + 's';
  }, 1000);
}

function showResults() {
  show('resultsScreen');
  const s1 = s1Locked.reduce((acc, _, i) => acc + (s1Answers[i] === stage1Players[i].answer ? 1 : 0), 0);
  const s2 = (s2Choice === stage2Answer) ? 1 : 0;
  document.getElementById('finalScore').textContent = score + ' / ' + totalQ;
  document.getElementById('s1Score').textContent = s1 + '/3';
  document.getElementById('s2Score').textContent = s2 + '/1';

  let title, text;
  if (score === 4) {
    title = "Elite GM Material";
    text = "You correctly read both the scouting reports and the analytics. You understand that context matters \u2014 neither eye test nor spreadsheet is always right.";
  } else if (score >= 2) {
    title = "Solid Front Office Instincts";
    text = "You showed a good understanding of when scouts and stats agree or diverge. Keep sharpening both lenses and you'll make better decisions.";
  } else {
    title = "Back to the Film Room";
    text = "Player evaluation is tricky! The key lesson: don't rely on just one perspective. Combine the eye test with the data for the full picture.";
  }
  document.getElementById('verdictTitle').textContent = title;
  document.getElementById('verdictText').textContent = text;
}

// ═══════════════════════════════════════════
//  UTILITIES
// ═══════════════════════════════════════════

function show(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function updateProgress() {
  const pct = (answered / totalQ) * 100;
  document.getElementById('progFill').style.width = pct + '%';
  document.getElementById('progLabel').textContent = answered + ' / ' + totalQ;
  document.getElementById('scoreLabel').textContent = 'Score: ' + score;
}
</script>
</body>
</html>
